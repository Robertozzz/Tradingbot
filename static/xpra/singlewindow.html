<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>IB Gateway (tight)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
	  html,body { margin:0; padding:0; background:#000; overflow:hidden }
	  #wrap { display:flex; flex-direction:row; align-items:flex-start; height:100vh }
	  /* Fallback; JS will right-size to 2Ã— app width */
	  iframe { border:0; display:block; flex:0 0 1280px; height:720px }
	</style>
</head>
<body>
  <div id="wrap">
    <iframe id="xpra-main"  src="/xpra-main/index.html?scaling=off"  title="IBKR Gateway"></iframe>
  </div>
	<script>
	  const IF = document.getElementById('xpra-main');
	  let appW = 1280, appH = 720; // until we hear from Xpra

	  function applySizes(){
	    const wide = appW * 2;
	    for (const ifr of [L,R]) {
		// make the iframe double-width so a second IBKR window fits to the right
		const dw = s.w * 2;
		ifr.style.flex ="0 0 "+dw+"px";
		ifr.style.width = dw + "px";
	    ifr.style.height = appH + 'px';
	    }
	    // left shows x=0; right shows x=appW (second pane)
	    try { L.contentWindow.scrollTo(0, 0); } catch(_) {}
	    try { R.contentWindow.scrollTo(appW, 0); } catch(_) {}
	  }

	  // Listen for the xpraWindowSize message from either iframe
	  addEventListener('message', (e) => {
	    if (e.origin !== location.origin) return;
	    const s = e.data && e.data.xpraWindowSize;
	    if (!(s && s.w && s.h)) return;
	    if (s.w !== appW || s.h !== appH) {
	      appW = s.w; appH = s.h;
	      applySizes();
	    }
	  });

	  // Keep view aligned even if client reflows
	  L.addEventListener('load', applySizes);
	  R.addEventListener('load', applySizes);
	  setInterval(applySizes, 700);
	</script>
</body>
</html>
